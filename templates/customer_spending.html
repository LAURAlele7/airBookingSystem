{% extends "base.html" %}
{% block title %}Track My Spending{% endblock %}

{% block head_extra %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .spending-container { padding: 20px; max-width: 1200px; margin: 0 auto; }
    .spending-content { display: flex; gap: 30px; align-items: flex-start; }
    
    /* Left Column: Controls */
    .control-column {
        flex: 0 0 300px;
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #ddd;
    }

    /* Right Column: Chart */
    .chart-column {
        flex: 1;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #ddd;
        min-height: 450px;
    }

    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
    .form-control { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    
    .btn-primary { 
        width: 100%; padding: 10px; 
        background-color: #007bff; color: white; 
        border: none; border-radius: 4px; cursor: pointer; 
    }
    .btn-primary:hover { background-color: #0056b3; }
    
    .total-card {
        margin-top: 20px;
        padding: 15px;
        background-color: #e9ecef;
        border-radius: 4px;
        text-align: center;
        border: 1px solid #dee2e6;
    }
    .total-amount {
        font-size: 1.8em;
        color: #28a745;
        font-weight: bold;
        margin-top: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="spending-container">
    <h2>Track My Spending</h2>
    
    <div class="spending-content">
        <!-- Left Column: Filters & Summary -->
        <div class="control-column">
            <a href="{{ url_for('customer.dashboard') }}" style="text-decoration: none; color: #007bff; font-weight: bold; display: block; margin-bottom: 15px;">&larr; Back to Dashboard</a>
            <hr>
            
            <form method="post">
                <div class="form-group">
                    <label>Start Date:</label>
                    <input type="date" name="start_date" class="form-control" value="{{ start_date }}">
                </div>
                <div class="form-group">
                    <label>End Date:</label>
                    <input type="date" name="end_date" class="form-control" value="{{ end_date }}">
                </div>
                <button type="submit" class="btn-primary">Update Range</button>
            </form>

            <div class="total-card">
                <div style="color: #666; font-size: 0.9em; text-transform: uppercase; letter-spacing: 1px;">Total Spending</div>
                <div class="total-amount">${{ total_spending }}</div>
            </div>
        </div>

        <!-- Right Column: Chart -->
        <div class="chart-column">
            <h3>Monthly Breakdown</h3>
            <div style="position: relative; height: 400px; width: 100%;">
                <canvas id="spendingChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    const months = {{ months | tojson }};
    const amounts = {{ amounts | tojson }};

    const ctx = document.getElementById("spendingChart").getContext("2d");
    
    const data = {
        labels: months.length > 0 ? months : ["No Data"],
        datasets: [{
            label: "Monthly Spending ($)",
            data: amounts.length > 0 ? amounts : [0],
            backgroundColor: "rgba(54, 162, 235, 0.6)",
            borderColor: "rgba(54, 162, 235, 1)",
            borderWidth: 1,
            borderRadius: 4
        }]
    };

    const chart = new Chart(ctx, {
        type: "bar",
        data: data,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `Spending: $${context.raw.toFixed(2)}`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) { return '$' + value; }
                    }
                }
            }
        }
    });
</script>
{% endblock %}