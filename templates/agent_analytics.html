{% extends "base.html" %}

{% block title %}Agent - Sales Analytics{% endblock %}

{% block header_title %}Agent Sales and Commission Analytics{% endblock %}

{% block head_extra %}
<style>
    /* Summary Card Styles */
    .analytics-summary {
        display: flex;
        justify-content: space-around;
        gap: 20px;
        margin-bottom: 40px;
        text-align: center;
    }
    .summary-card {
        flex: 1;
        padding: 20px;
        border-radius: 8px;
        background-color: #f0f8ff; /* Light blue background */
        border: 1px solid #cceeff;
    }
    .summary-card h3 {
        margin-top: 0;
        color: #007bff;
        font-size: 1.5em;
    }
    .summary-card p {
        font-size: 2em;
        font-weight: bold;
        color: #343a40;
    }
    
    /* Table Container Styles */
    .analytics-tables {
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
    }
    .table-container {
        flex: 1;
        min-width: 450px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: white;
    }
    .table-container h3 {
        margin-top: 0;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
        margin-bottom: 15px;
    }
</style>
{% endblock %}

{% block content %}
    <h2>Sales Performance Analytics</h2>

    <h3>Last 30 Days Sales Summary</h3>
    <div class="analytics-summary">
        <div class="summary-card">
            <h3>Total Commission</h3>
            <p>${{ "%.2f" | format(total_commission) }}</p>
        </div>
        <div class="summary-card">
            <h3>Avg. Commission per Ticket</h3>
            <p>${{ "%.2f" | format(avg_commission) }}</p>
        </div>
        <div class="summary-card">
            <h3>Tickets Sold</h3>
            <p>{{ ticket_count }}</p>
        </div>
    </div>

    <div class="analytics-tables">
        
        <div class="table-container">
            <h3>Top 5 Customers by Ticket Count (Last 6 Months)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Customer Email</th>
                        <th>Tickets Count</th>
                    </tr>
                </thead>
                <tbody>
                    {% if ticket_customers %}
                        {# Assuming ticket_customers and ticket_counts have the same length #}
                        {% for i in range(ticket_customers | length) %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ ticket_customers[i] }}</td>
                            <td>{{ ticket_counts[i] }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="3">No sales data found for the last 6 months.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <div class="table-container">
            <h3>Top 5 Customers by Commission (Last Year)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Customer Email</th>
                        <th>Total Commission</th>
                    </tr>
                </thead>
                <tbody>
                    {% if commission_customers %}
                        {# Assuming commission_customers and commissions have the same length #}
                        {% for i in range(commission_customers | length) %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ commission_customers[i] }}</td>
                            <td>${{ "%.2f" | format(commissions[i]) }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="3">No sales data found for the last year.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

{% endblock %}